---
################################################################################
##                 YOU CANNOT KNIT THIS FILE DIRECTLY FROM HERE!              ##
##              Instead use the scotland-update-template.R script             ##
################################################################################
output:
  bookdown::pdf_document2: 
    toc: FALSE
fontsize: 12pt
header-includes:
  - \usepackage{xcolor}
  - \usepackage{float}
  - \usepackage{tabu}
  - \usepackage{multirow}
  - \usepackage{colortbl}
  - \usepackage{lscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
  - \usepackage{flafter}
params:
  current.year: 2016
  dp.text: 1
  dp.tables: 2
bibliography: scotland.bib
csl: apa-with-notes.csl
---
  
```{r setup, echo = FALSE}
source(here::here("code/scotland.R"))
```

---
title: "`r paste("Local Authority Parking Finances in Scotland", params$current.year, "-", params$current.year-1999)`"
nocite: |
  `r paste0(bib$refs, collapse = ", ")`
---

\renewcommand{\arraystretch}{1.2}

  **Careful - there is no Aberdeen data in this report, so the totals won't match. (And there is some other source of errors in the Summary I suspect..) **

This note covers parking finances for the 32 local authorities in Scotland. They are required to submit details of their finances to the Scottish Government annually in a standard format. The figures are normally published in March, nearly a year after the financial year end. This note looks at the section on parking income and expenditure for `r FunFisc(4)` to `r FunFisc()` and is based primarily on Scottish Local Government Finance Statistics data (`r sco.bib.main.i.e`), as well as data reported by English and Welsh Local Government authorities, all of the sources of which care listed in the references[^1]. 

[^1]: Contains public sector information licensed under the [Open Government Licence v3.0](http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/). 


In addition, Transport Scotland is now publishing an annual report on decriminalised parking - the latest being: *Decriminalised Parking Enforcement – Local Authorities’ Income and Expenditure:* `r current.year` to `r current.year + 1` (`r sco.bib.main.pcn`),  which follows on from a report *released* in 2016 by the Scottish Parliament Rural Economy and Connectivity Committee that showed for the first time the number of Penalty Charge Notices (PCNs) issued and penalty income raised in Scotland for the years 2013-14 to 2015-16 (`r  sco.bib.old.pcn`). 

The Transport Scotland report deals with the statutory returns which are required by councils operating Decriminalised Parking Enforcement (DPE) to show how the surpluses are reinvested in transport activities. The local finance figures also include non-DPE activities, primarily off-street parking.

# Introduction

Table 1 shows that as of \color{red}December \color{black} `r current.year`, `r nrow(sco.dpe)` councils were operating DPE (using local traffic wardens and civil enforcement), while two more were actively working towards DPE, \color{red}one of which--Midlothian--introduced DPE in January 2018. \color{black} The remaining ten authorities were not currently considering DPE, but still use fixed penalty notices issued instead of fines enforced by the Justice of the Peace courts. See Figure \@ref(fig:map1) for the map[^2].

[^2]:  Boundary data for this and all furhter maps is from `r sco.bib.map`. Contains public sector information licensed under the [Open Government Licence v3.0.](http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/)

Police Scotland no longer enforces parking offences but now deals only with dangerous parking (e.g. on pedestrian crossings) by local arrangement. Several of the authorities not using DPE have rejected it because of the cost of setting it up and running it for the small number of parking offences. 

```{r dpe }
# pring DPE status table
sco.dpe %>% 
  kable( "latex", 
         booktabs = T, 
         align = c("l"),
         longtable = T,
         linesep = "",
         caption = "Parking arrangements for local authorities in Scotland",
         col.names = c("Using DPE", "Considering using DPE", "Not using DPE")) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped"), 
                font_size = 10) 
```


```{r map1, fig.height = 4, fig.cap = "Map showing implementation of decriminalised parking in Scotland"}
# plot DPE status map
plot(sco.map["dpe.status"], main = "", pal = viridis(3),
key.pos = NULL, border = "black", lwd = 0.3)
legend("topleft", fill = rev(viridis(3)),
legend = c( "DPE","No DPE", "DPE being introduced"), bty = "n",
cex = 0.8)
```

# Summary 

Table \@ref(tab:sumtab) and Figure \@ref(fig:fig1) show the summary accounts for local authorities in Scotland for fiscal years `r FunFisc(4)` to `r FunFisc()`. The income has 
`r ifelse(sco.summary$change[1] < -0.05, paste("fallen by", FunDec(-sco.summary$change[1], dp.text), "%"), ifelse(sco.summary$change[1] > 0.05, paste("increased by", FunDec(sco.summary$change[1], dp.text), "%"),"stayed approximately the same"))`, the expenditure has 
`r ifelse(sco.summary$change[2] < -0.05, paste("fallen by", FunDec(-sco.summary$change[2], dp.text), "%"), ifelse(sco.summary$change[1] > 0.05, paste("increased by", FunDec(sco.summary$change[2], dp.text), "%"),"stayed approximately the same"))`, and the surplus has
`r ifelse(sco.summary$change[3] < -0.05, paste("fallen by", FunDec(-sco.summary$change[3], dp.text), "%"), ifelse(sco.summary$change[1] > 0.05, paste("increased by", FunDec(sco.summary$change[3], dp.text), "%"),"stayed approximately the same"))`
compared to the previous fiscal year. Total transport has
`r ifelse(sco.summary$change[4] < -0.05, paste("fallen by", FunDec(-sco.summary$change[4], dp.text), "%"), ifelse(sco.summary$change[1] > 0.05, paste("increased by", FunDec(sco.summary$change[4], dp.text), "%"),"stayed approximately the same"))` and the surplus now represents `r paste(FunDec(sco.summary[5, 6], dp.text), "%")` of transport costs. Parking makes a 
`r ifelse(sco.summary[5, 6] < eng.trans - 0.05 , "smaller", ifelse(sco.summary[5, 6] > eng.trans + 0.05,  "larger","similar"))` contribution to overall transport expenditure in Scotland compared with England where it is around `r FunDec(eng.trans, dp.text)` % of total transport.

```{r sumtab, echo = FALSE, message = FALSE, warning = FALSE}
# print summary data
sco.summary.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 2, 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Summary of parking accounts for Scotland (£ millions)",
         col.names = c("", "", yearz, paste0("Change ", current.year, "-", 
                                             current.year-1999, " on ", current.year-1, "-", current.year-1999-1)),
         linesep = "") %>% 
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position"), 
                font_size = 10) %>% 
  column_spec(1:2, width = "3cm")
```



```{r fig1, echo = FALSE, fig.cap = "Parking revenues--Scotland", fig.pos = "H", fig.showtext=TRUE,}
old.par <- par(mar = c(5.1, 4.1, 3.1, 2.1))
plot(sco.plot$year, sco.plot$income.total, 
     ylim = c(0, max(sco.plot$income.total) ), 
     type = "l",
     lwd = 2,
     col = viridis(3)[1],
     bty = "n",
     xlab = "Fiscal Year",
     ylab = "£ (millions)",
     axes = FALSE, family = "meri", cex.lab = 0.8)
axis(1, at = sco.plot$year, 
     labels = rep("", length(sco.plot$year),
                  family = "meri", cex.axis = 0.6, las = 2, srt = 45))
text(sco.plot$year, par("usr")[3] - 0.5, 
     labels = paste0(sco.plot$year, "-", sco.plot$year-1999), 
     srt = 45, adj = c(1.2,1.5), xpd = TRUE, family = "meri", cex = 0.6)
axis(2, las = 2, family = "meri", cex.axis = 0.6 )
grid(nx = NA, ny = NULL, lty = "93")
lines(sco.plot$year, sco.plot$expend.total, 
      ylim = c(0, max(sco.plot$expend.total)), 
      type = "l",
      lwd = 2,
      col = viridis(3)[2])
lines(sco.plot$year, sco.plot$surplus.total, 
      ylim = c(0, max(sco.plot$surplus.total)), 
      type = "l",
      lwd = 2,
      col = viridis(3)[3])
par(family = "meri")
legend("bottomright",
       legend = c("Income", "Expenditure", "Surplus"),
       bty = "n",
       col = viridis(3), 
       lwd = 2, cex = 0.8,  xpd = TRUE)
par(old.par)
```

Since `r FunFisc(4)` income has `r ifelse(sco.summary[1,6] > sco.summary[1,2], "risen", "fallen")` by 
`r FunDec(100*sco.summary[1,6]/sco.summary[1,2] - 100, dp.text)` % and expenditure has `r ifelse(sco.summary[2,6] > sco.summary[2,2], "risen", "fallen")` by `r FunDec(100*sco.summary[2,6]/sco.summary[2,2] - 100, dp.text)` %. Over the same period the surplus has `r ifelse(sco.summary[3,6] > sco.summary[3,2], "risen", "fallen")` by `r FunDec(100*sco.summary[3,6]/sco.summary[3,2] - 100, dp.text)` %. Figure \@ref(fig:fig1) gives a longer term overview of the trends in incomes, expenditures and surpluses. 


```{r compare, echo = FALSE}
# pring comparison table for all three countrires
sum.gb.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = c(rep(0, 6), 2), 
         escape = F,
         longtable = T,
         align = c("r"),
         col.names = c("", "England without London", "London", 
                       "Scotland", "Wales", "Great Britain"),
         caption = paste0("Comparison of parking income and expenditure in across the nations of Great Britain (£ millions)"), 
         format.args = list(big.mark = ","),
         linesep = "") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("hold_position", "striped", "repeat_header"), 
                font_size = 10) %>% 
  column_spec(1, width = "5cm") %>% 
  row_spec(c(1, 4), hline_after = TRUE)
```

Table \@ref(tab:compare) provides a comparison with London, England excluding London, and Wales for  for the most recent available data, while Table \@ref(tab:change) compares the changes between `r FunFisc()` and `r FunFisc(1)` with the average annual change over the `r FunN2W(current.year - ref.year)`-year period from `r FunFisc(current.year-ref.year)`.

On average, parking surpluses in Great Britain have risen by about `r FunDec(sum.gb.change$surplus.change.4[sum.gb.change$country == "Great Britain"], dp.text)` % annually over the past `r FunN2W(current.year - ref.year)` years compared with `r FunDec(rpi.annual, dp.text)` % annually for the Retail Prices Index during the same period (`r sco.bib.rpi`).

```{r change}
# print change over 5 years. 
sum.gb.change.tab.formatted  %>% 
  kable( "latex", 
         booktabs = T, 
         digits = c(rep(0, 6), 2), 
         escape = F,
         longtable = T,
         align = c("r"),
         col.names = c("",  "England without London", "London", 
                       "Scotland", "Wales", "Great Britain"),
         caption = paste0("Changes in parking income and expenditure from ", FunFisc(current.year - ref.year), " to ", FunFisc(), " across the nations of Great Britain"), 
         format.args = list(big.mark = ","),
         linesep = "") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("hold_position", "striped", "repeat_header"), 
                font_size = 10) %>% 
  column_spec(1, width = "6.7cm") %>% 
  column_spec(6, width = "1.8cm") %>% 
  row_spec(c(2,4), hline_after = TRUE)
```

#  Income

Total council parking income from all sources in `r FunFisc()` was £`r FunDec(sco.summary[1, 6], dp.text)` million, `r FunDec(sco.summary$change[1], dp.text)` % `r ifelse (sco.summary$change[1] > 0, "higher", "lower")` than `r FunFisc(1)`. Note that this includes meter and penalty income for on- and off-street parking, but does not include income received by private parking companies.  Table \@ref(tab:incometab) ranks the Scottish councils in terms of parking income. 

`r FunFirstup(FunN2W(income.bin[2]))` councils increased their income over the past year and `r FunN2W(income.bin[1])` decreased their income. `r if (sco.no.income > 0 ) {paste0(" ", FunFirstup(FunN2W(sco.no.income)), " councils did not show any income in ", FunFisc(), ".")}` The changes from `r FunFisc(1)` are mapped in Figure \@ref(fig:incomefig). 

The top three Scottish cities by income were `r paste0(names(sco.income.top3)[1], ", ", names(sco.income.top3)[2], ", and ", names(sco.income.top3)[3])`, and between them accounted for `r FunDec(sco.income.top3[1], dp.text)` % of parking income. 

`r sco.income.change.top3[1,2]` increased their income by `r FunDec(sco.income.change.top3$change[1], dp.text)` %
while `r sco.income.change.top3[2,2]` and `r sco.income.change.top3[3,2]` increased  by `r FunDec(sco.income.change.top3$change[2], dp.text)` % and `r FunDec(sco.income.change.top3$change[3], dp.text)` % respectively`r if(nrow(sco.income.excluded.top) > 0) paste0(" (excluding ", FunMultiText(sco.income.excluded.top$auth.name), " with income under £30,000)")`. The biggest decreases were in `r sco.income.change.bottom2[2,2]` (`r FunDec(abs(sco.income.change.bottom2$change[2]), dp.text)` %), and `r sco.income.change.bottom2[1,2]` (`r FunDec(abs(sco.income.change.bottom2$change[1]), dp.text)`  %)`r if(nrow(sco.income.excluded.bottom) > 0) paste0(" (excluding ", FunMultiText(sco.income.excluded.bottom$auth.name), " with income under £30,000)")`.

```{r incometab, echo = FALSE, message = FALSE, warning = FALSE}
sco.income.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = c(rep(0, 6), 2), 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Parking income for Scotland (£,000)",
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz, 
                       paste0("Change ", FunFisc(), 
                              " on ", FunFisc(1)),
                       paste0("Average annual change since ", FunFisc(4)))) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("hold_position", "striped", "repeat_header"), 
                font_size = 9) %>% 
  column_spec(1, width = "3.5cm") %>% 
  column_spec(7, width = "1.5cm") %>% 
  column_spec(8, width = "1.5cm") %>% 
  
  row_spec(32, hline_after = TRUE)
```

```{r incomefig, fig.cap = "Map of change in parking income since previous fiscal year"}
# map change in income from last year
FunMap(sco.income, which = 1, shp = uc, country = "^S",  dir = 1)
```

Table \@ref(tab:pcntab) shows the number of PCNs issued council by council in Scotland for the years `r FunFisc(x)` to `r FunFisc()`, with the average income per PCN for  `r FunFisc()`. The total number of PCNs has `r ifelse(sco.pcn.numbers.annual > 0, "increased", "decreased")` by around `r FunDec(sco.pcn.numbers.annual, dp.text)` % a year on average. \color{red}The penalty for parking can be £40 or £50 for a minor offence such as overstaying at a meter, or £60 for a more serious offence such as parking where it is not allowed. \color{black} These figures are reduced by 50% for prompt payment and increased by 50% for slow payment. The average recovery per PCN was £`r FunDec(sco.pcn.tot.average, dp.text)` in `r FunFisc()`.

```{r incomefig4, fig.cap = "Map of average annual change in parking income over the past four years", fig.height = 4}
# map expenditure change
FunMap(sco.income, which = 4, shp = uc, country = "^S",dir = -1)
```



```{r pcntab}
# print PCN numbers table
sco.pcn.numbers.formatted %>% 
  kable( "latex", 
         booktabs = TRUE, 
         digits = 0, 
         escape = FALSE,
         longtable = TRUE,
         align = c("r"),
         caption = paste("Number of PCNs for councils using DPE and average", 
                         FunFisc(), "income per PCN"),
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz.pcn, 
                       paste0("£/PCN (", FunFisc(), ")"))) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_header"), 
                font_size = 10) %>% 
  column_spec(1, width = "3.7cm") %>% 
  row_spec(nrow(sco.pcn.numbers)- 1, hline_after = TRUE)
```

```{r pcnprop}
# print proporiton of PCN income in total
sco.pcn.prop.formatted %>% 
  kable( "latex",
         booktabs = TRUE,
         digits = 0,
         escape = FALSE,
         longtable = TRUE,
         align = c("r"),
         caption = paste("Proportion of parking income from PCNs in Scottish councils using DPE with London, and England excluding London, for comparison"),
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz.pcn)) %>% 
  kable_styling(full_width = TRUE,
                latex_options =c("HOLD_position", "striped", "repeat_header"),
                font_size = 10) %>%
  column_spec(1, width = "5cm") %>%
  row_spec(nrow(sco.pcn.numbers)-1, hline_after = TRUE)
```

Scottish councils with DPE earn `r FunDec(sco.pcn.prop[nrow(sco.pcn.numbers), ncol(sco.pcn.prop)], dp.text)` % of their income from PCNs, which is \color{red}about half of the equivalent proportions for London and for the rest of England \color{black} (see Table \@ref(tab:pcnprop)). \color{red} It would appear that either Scottish drivers are more law-abiding, or the enforcement regime in Scotland is not as rigorous.\color{black}

\newpage

# Expenditure

```{r expendfig, fig.cap = "Map of change in parking expenditure since previous fiscal year"}
# map expenditure change
FunMap(sco.expend, which = 1, shp = uc,  country = "^S", dir = -1)
```


Table \@ref(tab:expendtab) ranks the councils in terms of expenditure on parking.

Overall expenditure has `r ifelse( sco.expend.t[2] > 0, "risen", "fallen")` by £`r FunDec(abs(sco.expend.t[2]), dp.text)` million (`r FunDec(abs(sco.expend.t[1]), dp.text)` %) after a `r ifelse( sco.expend.t[3] > 0, paste0("rise of £", FunDec(sco.expend.t[3], dp.text), " million last year"), paste0("fall of £", FunDec(abs(sco.expend.t[3]), dp.text), " million last year"))`, with `r FunN2W(expend.bin[2])` councils having increased their costs and `r FunN2W(expend.bin[1])` having reduced them. The changes from `r FunFisc(1)` are mapped in Figure \@ref(fig:expendfig). 

The largest increase in expenditure occured in `r sco.expend.change.top3[1,2]` where it increased by `r FunDec(sco.expend.change.top3$change[1], dp.text)` %
while `r sco.expend.change.top3[2,2]` and `r sco.expend.change.top3[3,2]` increased  by `r FunDec(sco.expend.change.top3$change[2], dp.text)` % and `r FunDec(sco.expend.change.top3$change[3], dp.text)` % respectively`r if(nrow(sco.expend.excluded.top) > 0) paste0(" (excluding ", FunMultiText(sco.expend.excluded.top$auth.name), " with expenditure under £30,000)")`. The biggest decreases were in `r sco.expend.change.bottom2[2,2]` (`r FunDec(abs(sco.expend.change.bottom2$change[2]), dp.text)` %), and `r sco.expend.change.bottom2[1,2]` (`r FunDec(abs(sco.expend.change.bottom2$change[1]), dp.text)`  %)`r if(nrow(sco.expend.excluded.bottom) > 0) paste0(" (excluding ", FunMultiText(sco.expend.excluded.bottom$auth.name), " with expenditure under £30,000)")`.

The table also shows the proportion of income taken up by costs in `r FunFisc()`. Nationally in Scotland it is `r FunDec(sco.expend.p[3], dp.text)` % with Glasgow at `r FunDec(sco.expend.p[2], dp.text)` % and Edinburgh at `r FunDec(sco.expend.p[1], dp.text)` %.


```{r expendtab, echo = FALSE, message = FALSE, warning = FALSE}
sco.expend.formatted %>% 
  kable( "latex", 
         booktabs = TRUE, 
         digits = 0, 
         escape = FALSE,
         longtable = TRUE,
         align = c("r"),
         caption = "Parking expenditure for Scotland (£,000)",
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz, 
                       paste0("Change ", FunFisc(), 
                              " on ", FunFisc(1)), 
                       paste0("Average annual change since ", FunFisc(4)),
                       "Expenditure as proportion of income")) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_header"), 
                font_size = 9) %>% 
  column_spec(1, width = "3.1cm") %>% 
    column_spec(7, width = "1.5cm") %>%
    column_spec(8, width = "1.5cm") %>%
  column_spec(9, width = "1.5cm") %>% 
  row_spec(32, hline_after = TRUE)
```


```{r expendfig4, fig.cap = "Map of average annual change in parking expenditure over the past four years", fig.height = 4}
# map expenditure change
FunMap(sco.expend, which = 4, shp = uc, country = "^S",dir = -1)
```

Table \@ref(tab:expendprop) shows the proportion of income taken up by expenditure over the previous four years. Across Scotland it was `r FunDec(sco.expend.of.income[33,6], dp.text)` % compared to `r FunDec(sco.expend.of.income[33,5], dp.text)` % in the previous year, suggesting `r ifelse(sco.expend.of.income[33,6] < sco.expend.of.income[33,5], "improving", "declining")` efficiency in operations. 

Edinburgh’s expenditure was `r FunDec(sco.expend.of.income[sco.expend.of.income$auth.name == "Edinburgh City",6], dp.text)` % having `r ifelse(sco.expend.of.income[sco.expend.of.income$auth.name == "Edinburgh City",6] < sco.expend.of.income[sco.expend.of.income$auth.name == "Edinburgh City",5], "fallen", "risen")` since last year, and Glasgow's has `r ifelse(sco.expend.of.income[sco.expend.of.income$auth.name == "Glasgow City",6] < sco.expend.of.income[sco.expend.of.income$auth.name == "Glasgow City",5], "fallen", "risen")` to `r FunDec(sco.expend.of.income[sco.expend.of.income$auth.name == "Glasgow City",6], dp.text)` %. \color{red} Most of the medium-sized councils spend 50–90% of their income on parking management, which includes enforcement. \color{black} Care should be taken in interpreting the percentages towards the bottom of the table, as the very low parking incomes can lead to extreme values which are less meaningful.   

```{r expendprop}
sco.expend.of.income.formatted %>% 
  kable( "latex", 
         booktabs = TRUE, 
         digits = 0, 
         escape = FALSE,
         longtable = TRUE,
         align = c("r"),
         caption = "Parking expenditure as proportion of parking income",
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz)) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_header"), 
                font_size = 10) %>% 
  column_spec(1, width = "3.7cm") %>% 
  row_spec(32, hline_after = TRUE) %>% 
  footnote(symbol = "Empty cells indicate the council reported no income and/or no expenditure")
```

\newpage

# Surpluses

Table \@ref(tab:surplustab) shows the parking surpluses from `r FunFisc(4)` to `r FunFisc()` and the change from `r FunFisc(1)` to `r FunFisc()`. It also shows the proportion that parking surpluses represent of total transport expenditure.


The total *surpluses* for Scotland amounted to £`r FunDec((sco.surplus.totals.table[34, 6]/1000), dp.text)` million between `r  sco.poz.surplus ` authorities, of which the top three--`r paste0(names(sco.surplus.top3)[1], ", ", names(sco.surplus.top3)[2], ", and ", names(sco.surplus.top3)[3])`--accounted for `r FunDec(sco.surplus.top3[1],  dp.text)` %.  `r FunFirstup(FunN2W(surplus.bin[1]))` councils made a loss with the total of parking deficits `r ifelse(sco.surplus.totals.table[33,6] > sco.surplus.totals.table[33,5], "falling", "rising")` to £`r FunDec(-sco.surplus.totals.table[33,6]/1000, dp.text)` million from £`r FunDec(-sco.surplus.totals.table[33,5]/1000, dp.text)` million last year. 

Overall, parking contributed £`r FunDec((sco.surplus.totals.table[35, 6]/1000), dp.text)` million to local authority finances in Scotland in `r FunFisc()` compared with £`r FunDec((sco.surplus.totals.table[35, 5]/1000), dp.text)` million in `r FunFisc()`, an increase of `r FunDec((sco.surplus.totals.table[35, 7]), dp.text)` %. 

`r sco.surplus.change.top3[1,2]` increased their surplus by `r FunDec(sco.surplus.change.top3$change[1], dp.text)` %
while `r sco.surplus.change.top3[2,2]` and `r sco.surplus.change.top3[3,2]` increased  by `r FunDec(sco.surplus.change.top3$change[2], dp.text)` % and `r FunDec(sco.surplus.change.top3$change[3], dp.text)` % respectively`r if(nrow(sco.surplus.excluded.top) > 0) paste0(" (excluding ", FunMultiText(sco.surplus.excluded.top$auth.name), " with a surplus/deficit under £30,000)")`. The biggest decreases were in `r sco.surplus.change.bottom2[2,2]` (`r FunDec(abs(sco.surplus.change.bottom2$change[2]), dp.text)` %), and `r sco.surplus.change.bottom2[1,2]` (`r FunDec(abs(sco.surplus.change.bottom2$change[1]), dp.text)`  %)`r if(nrow(sco.surplus.excluded.bottom) > 0) paste0(" (excluding ", FunMultiText(sco.surplus.excluded.bottom$auth.name), " with a surplus/deficit under £30,000)")`.


```{r surplustab}

# setup table
sco.surplus.totals.table.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 0, 
         longtable = T,
         escape = F,
         align = c("r"),
         caption = "Parking surpluses for Scotland (£,000)",
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz, 
                       paste0("Change ", current.year, "-", current.year-1999, 
                              " on ", current.year-1, "-", current.year-1999-1), "Surplus as proportion of transport spending")) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_headers"), 
                font_size = 10) %>% 
  column_spec(1, width = "3.7cm") %>% 
  row_spec(c(32, 34), hline_after = TRUE) %>% 
  footnote(symbol = "Where the change in surplus is actually a change in deficit, the values are in italics")
```

\newpage
# Comparison between Local Government Finance figures and Transport Scotland decriminalised parking enforcement figures

As mentioned in the introduction, there are now two sources of information from Scottish local authorities giving the income, expenditure and surpluses for parking: the Local Government Finance (LGF) figures, which cover all the parking activities; and the Transport Scotland figures (for those authorities operating DPE), which cover only the statutory elements of on-street parking and penalties, and do not include council-run off-street parking. Table 11 compares the two sets of figures. The differences between the two sources may not be due solely to off-street income and expenditure only being included in the LGF figures as it is possible that councils use different figures for overheads and other costs in reporting the two sets of figures.

The biggest difference in reported income is in `r sco.compare.income.ht[1,1]` where the LGF figures show £`r FunDec(sco.compare.income.ht[1,2]/1000, dp.text)` million more income than the Transport Scotland set. Its expenditure is reported by LGF as £`r FunDec(sco.compare.income.ht[1,3]/1000, dp.text)` million `r ifelse(sco.compare.income.ht[1,3] > 0, "higher", "lower")`, making the difference in the two surpluses £`r FunDec(sco.compare.income.ht[1,4]/1000, dp.text)` million. \color{red}Glasgow’s off-street car parks and on-street enforcement have been run by City Parking (Glasgow) LLP, a wholly-owned subsidiary of Glasgow Council since 2007. Its accounts for 2016-17 show income of £15.2 million, expenditure of £13.0 million and an operating profit of £2.8 million which almost exactly matches the difference. \color{black}

In `r sco.compare.income.ht[2,1]`, the LGF income is £`r FunDec(sco.compare.income.ht[2,2]/1000, dp.text)` million higher, \color{red}but Edinburgh does not operate any off-street carparks as they are all commercially run.\color{black}. On the other hand `r sco.compare.income.ht[4,1]` has LGF income £`r FunDec(abs(sco.compare.income.ht[4,2])/1000, dp.text)` million less than the DPE income, and `r sco.compare.income.ht[3,1]` has LGF income reported to be £`r FunDec(abs(sco.compare.income.ht[3,2])/1000, dp.text)` million less. *NB: Aberdeen is only the biggest negative difference here because its LGF income is currently zero!* 
  
\newpage
\blandscape
```{r comparetab}
# print table
sco.compare.tab %>% 
  kable( "latex", 
         booktabs = T,
         digits = 0, 
         escape = F,
         align = c("r"),
         caption = paste0("Comparison of Local Government Finance and Transport for Scotland DPE parking accounts for ", FunFisc()," (£,000)"),
         format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}",
                       rep(c("Income", "Expenditure", "Surplus"), 3)))%>% 
  add_header_above(c(" ", "Local Government Finance" = 3, 
                     "Transport Scotland" = 3, 
                     "Difference" = 3)) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_headers"), 
                font_size = 7) %>% 
  column_spec(1, width = "3.7cm") %>% 
  row_spec(c(32), hline_after = TRUE) %>% 
  footnote(symbol = "The totals calculated in the final 'Differences' column only take into account LAs that have DPE")

```
\elandscape

## References {-}

