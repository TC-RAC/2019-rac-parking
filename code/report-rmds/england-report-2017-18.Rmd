---
################################################################################
##                 YOU CANNOT KNIT THIS FILE DIRECTLY FROM HERE!              ##
##              Instead use the england-update-template.R script             ##
################################################################################
output:
  bookdown::pdf_document2: 
    toc: FALSE
fontsize: 12pt
header-includes:
  - \usepackage{xcolor}
  - \usepackage{float}
  - \usepackage{tabu}
  - \usepackage{multirow}
  - \usepackage{colortbl}
  - \usepackage{lscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
  - \usepackage{flafter}
params:
  current.year: 2017
  dp.text: 1
  dp.tables: 2
bibliography: england.bib
csl: apa-with-notes.csl
---
  
```{r setup, echo = FALSE, warning=FALSE, message=FALSE}
source(here::here("code/england.R"))
```

---
title: "`r paste("Local Authority Parking Finances in England", params$current.year, "-", params$current.year-1999)`"
nocite: |
  `r paste0(bib$refs, collapse = ", ")`
---
  
\renewcommand{\arraystretch}{1.2}

# Introduction


This report uses the MHCLG (formerly DCLG) tables on parking income and expenditure for the period from `r FunFisc(4)` to `r FunFisc()` (`r  eng.bib.main.i.e`). All councils are required to report their financial information to government, in a consistent format, although there may be some differences in interpretation of what that format is and what it covers. Earlier, councils also submitted budgets for the `r FunFisc(-1)` financial year but on a less detailed basis (`r eng.bib.next.budget`). These figures are included where appropriate. The figures have to be on an as-received cash basis without any provision for bad debts or any allowance for capital charges (interest or deprecation).

This report covers the 353 local authorities in England but excludes `r FunN2W(n.nat.parks)`  national parks which declare income from parking and show a total surplus of £`r FunDec(surplus.nat.parks/1000, dp.text)` million. It also excludes the Nottingham workplace parking levy which is estimated to have generated £`r FunDec(surplus.wpl/1000, dp.text)` million surplus in `r FunFisc()`. 

The income and cost headings used in this analysis are: 

1. On-street income, expenditure and income from penalty charges 
2. Off-street income, expenditure 
3. Total transport income, expenditure 

\color{red} These headings do not always agree with accounts published by local authorities because of their different treatment of overheads and allocation of surpluses to other transport projects. Furthermore six local authorities include off-street parking in their internal trading accounts which leads to further inconsistencies. These trading figures have been added to the revenue accounts. \color{black}


\newpage

# Summary

```{r sumtab, echo = FALSE, message = FALSE, warning = FALSE}
# print summary data
eng.summary.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 2, 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Summary of parking accounts for England (£ millions)",
         col.names = c("", "", yearz, 
                       paste0(FunFisc(), " budget"),
                       paste0(FunFisc(-1), " budget"),
                       paste0("Change ", current.year, "-", 
                                             current.year-1999, " on ", current.year-1, "-", current.year-1999-1)),
       #  format.args = list(big.mark = ","),
         linesep = "") %>% 
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position"), 
                font_size = 10) %>% 
  column_spec(1, width = "1.6cm") %>% 
  column_spec(2, width = "2.4cm") %>% 
  column_spec(8:9, width = "1.2cm") %>% 
  column_spec(10, width = "1.2cm")  %>% 
  row_spec(c(4, 7), extra_latex_after = "\\cline{2-7} \\cline{10-10}") %>% 
  row_spec(c(10),  extra_latex_after = "\\cline{2-10}") %>% 
  row_spec(11, bold = TRUE) %>% 
  footnote(symbol = "Cells may not add up exactly due to rounding.")
```

Total income from parking in `r FunFisc()` in England was £`r FunDec(pull(summary[5,10]/1000), 2)` billion, `r FunDec(inc.ch, dp.text)` % `r ifelse(inc.ch < 0, "lower", "higher")` than in `r FunFisc(1)`. On-street income `r ifelse(inc.on.ch < 0, "fell", "rose")` by `r FunDec(inc.on.ch, dp.text)` % and off-street income `r ifelse(sign(inc.on.ch) == sign(inc.off.ch), "", ifelse(inc.off.ch < 0, "fell", "rose"))` by `r FunDec(inc.off.ch, dp.text)` % . Expenditure `r ifelse(exp.on.ch < 0, "fell", "rose")` by `r FunDec(exp.on.ch, dp.text)` % for on-street and `r ifelse(sign(exp.on.ch) == sign(exp.off.ch), "", ifelse(exp.off.ch < 0, "fell", "rose"))` by `r FunDec(exp.off.ch, dp.text)` % off-street parking. As a result, the combined surplus from both on- and off-street parking was £`r FunDec(pull(summary[5,12]), 0)` million, `r FunDec(sur.ch, dp.text)`% `r ifelse(sur.ch < 0, "lower", "higher")`  than the previous financial year and `r FunDec(sur.ch4, dp.text)`% `r ifelse(sur.ch4 < 0, "lower", "higher")`  than four years ago. 

Local authorities `r ifelse(sur.budg.diff > 0, "exceeded", "fell short of")` their `r FunFisc()` budgeted surplus of £`r FunDec(summary$surplus.total[6], 0)` million by `r FunDec(sur.budg.diff, dp.text)` %. Their budgeted surplus for this next financial year (`r FunFisc(-1)`) is £`r FunDec(summary$surplus.total[7], 0)` million, `r FunDec(sur.budg.inc, dp.text)`% `r ifelse(sur.budg.inc < 0, "lower", "higher")`   than the actual for `r FunFisc()`. If the `r FunFisc(-1)` budget `r ifelse(sur.budg.diff > 0, "is exceeded", "falls short")` by the same proportion as the `r FunFisc()` outcome, then total parking surpluses would amount to £`r FunDec(sur.hyp, 0)`million.

The on-street parking surpluses must by law be used for transport projects. Overall, local transport net expenditure in `r FunFisc()` `r ifelse(abs(tran.ch) < 0.5, "remained relatively unchanged at", ifelse(tran.ch < 0, "fell to", "increased to"))`  £`r FunDec(summary$transport.total[5]/1000, 1)` billion. Without the contribution from parking surpluses, net expenditure would have been `r FunDec(summary$prop.net.expen[5], dp.text)`% higher.

```{r fig1, echo = FALSE, fig.cap = "Parking revenues--England", fig.pos = "H", fig.showtext=TRUE,}
old.par <- par(mar = c(5.1, 4.1, 3.1, 2.1))
plot(eng.plot$year, eng.plot$income.total, 
     ylim = c(0, max(eng.plot$income.total, na.rm = TRUE) ), 
     type = "l",
     lwd = 2,
     col = viridis(3)[1],
     bty = "n",
     xlab = "Fiscal Year",
     ylab = "£ (millions)",
     axes = FALSE, family = "meri", cex.lab = 0.8)
axis(1, at = eng.plot$year, 
     labels = rep("", length(eng.plot$year),
                  family = "meri", cex.axis = 0.6, las = 2, srt = 45))
text(eng.plot$year, par("usr")[3] - 0.5, 
     labels = paste0(eng.plot$year, "-", eng.plot$year-1999), 
     srt = 45, adj = c(1.2,1.5), xpd = TRUE, family = "meri", cex = 0.6)
axis(2, las = 2, family = "meri", cex.axis = 0.6 )
grid(nx = NA, ny = NULL, lty = "93")
lines(eng.plot$year, eng.plot$surplus.budget, 
      type = "l",
      lwd = 2, lty = "63",
      col = viridis(3)[3])
lines(eng.plot$year, eng.plot$expend.total, 
      type = "l",
      lwd = 2,
      col = viridis(3)[2])
lines(eng.plot$year, eng.plot$surplus.total, 
      type = "l",
      lwd = 2,
      col = viridis(3)[3])

par(family = "meri")
legend("bottomright",
       legend = c("Income", "Expenditure", "Surplus", "Budgeted surplus"),
       bty = "n",
       col = viridis(3)[c(1,2,3,3)], 
       lwd = 2, cex = 0.8, lty = c("99","99","99","63"), xpd = TRUE)
par(old.par)
```


\newpage
\renewcommand{\arraystretch}{1.35}
```{r sumtablondon, echo = FALSE, message = FALSE, warning = FALSE}
# print summary data
eng.summary.london.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 2, 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Summary of parking accounts for England (£ millions)",
         col.names = c("", "", "London", "Rest of England", "All of England",
                       "London percentage"),
         linesep = "") %>% 
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position"), 
                font_size = 10) %>% 
  column_spec(1, width = "2cm") %>% 
  column_spec(2, width = "2cm")  %>% 
    row_spec(c(2,5, 8),  extra_latex_after = "\\cline{2-6}") 
```

\renewcommand{\arraystretch}{1.2}

Only `r FunDec(lnd.prop.off, dp.text)` % of London boroughs’ parking income comes from off-street car parking as most off-street parking is commercially run. For the rest of England `r FunDec(rest.prop.off, dp.text)` % of income is from off-street parking. 

The parking surplus in London was £`r lnd.surplus`million, `r FunDec(lnd.prop.surplus, dp.text)`% of the total for England, although London only has only \color{red}10% \color{black}of the total cars in England but of course incoming commuters and visitors will contribute to parking fees and penalties which are much higher than in the rest of England.

\newpage

# Income 

Parking income is derived from three main sources: meter income, residents’  business permits, and penalties. Other sources are towing and storage charges although relatively few councils operate pounds now. Total income in `r FunFisc()` was £`r formatC(inc.tot, big.mark = ",")` million, `r FunDec(inc.ch, dp.text)`% higher than in `r FunFisc(1)`. 

Income from on-street tickets and permits was £`r FunDec(inc.fnp, 0)` million, (`r ifelse(inc.fnp.ch>0, "up", "down")` `r FunDec(inc.fnp.ch, dp.text)` %), and a further £`r FunDec(inc.pcn, 0)` million came from on-street penalty charges (`r ifelse(inc.pcn.ch>0, "up", "down")` `r FunDec(inc.pcn.ch, dp.text)` %) and £`r FunDec(inc.off, 0)` million (`r ifelse(inc.off.ch>0, "up", "down")` `r FunDec(inc.off.ch, dp.text)` %)from off-street charges and penalties. Note that this does not include off-street income received by commercial off-street parking facilities. 

Penalty income in London was £`r FunDec(inc.london.pcn, 0)` million, `r FunDec(inc.london.pcn.ch, dp.text)`% `r ifelse(inc.london.pcn > 0, "higher", "lower")` than in 2016-17. \color{red} The number of parking PCNs in London rose by 4% to 3.3 million (excluding TfL) but the average income per PCN was £74 in 2017-18 unchanged from 2016-17. \color{black} Penalty income in the rest of England was £`r FunDec(inc.rest.pcn, 0)` million, `r FunDec(inc.rest.pcn.ch, dp.text)`% `r ifelse(inc.rest.pcn > 0, "higher", "lower")` than the previous year but \color{red}only just over a half\color{black} of that collected in London reflecting the lower penalty tariffs outside London.^[\color{red}The penalty for more serious parking offences in London is £130 or £110 and £70 outside. For less serious offences the penalties are £80 or £60 and £50. These a reduced by 50% for payment within14 days. \color{black}]


# Expenditure

Overall expenditure on parking rose to £`r FunDec(exp.tot,0)`million, up `r FunDec(exp.ch , dp.text)`% from `r FunFisc(1)` for both on-street and off-street. Expenditure in London went `r ifelse( exp.london.tot.ch > 0, "up", "down")` by `r FunDec(exp.london.tot.ch, dp.text)` % and `r ifelse(sign(exp.london.tot.ch == exp.rest.tot.ch), "", ifelse(exp.rest.tot.ch > 0, "up", "down"))` by `r FunDec(exp.rest.tot.ch, dp.text)` % in the rest of England. Expenditure represents `r FunDec(exp.prop.inc.on, dp.text)` % of income for on-street parking and `r FunDec(exp.prop.inc.on, dp.text)` % for off-street. 



# Surpluses 

In total, councils in England made a surplus of £`r FunDec(sur.tot,0)` million in `r FunFisc()`, `r FunDec(sur.ch, dp.text)` % `r ifelse(sur.ch > 0, "higher", "lower")` than in `r FunFisc(1)`. Of this total, £`r FunDec(sur.london, 0)` million (`r FunDec(sur.london.prop, dp.text)` %) came from London and £`r FunDec(sur.rest, 0)` million from the rest of England. This excludes a £`r FunDec(surplus.nat.parks/1000, dp.text)` million surplus from parking in National Parks and a £`r FunDec(surplus.wpl/1000, dp.text)` million surplus from the Nottingham workplace parking levy.

The London surplus of £`r FunDec(sur.london,0)` million in `r FunFisc()` was `r FunFisc()`, `r FunDec(sur.london.tot.ch, dp.text)` % `r ifelse(sur.london.tot.ch > 0, "higher", "lower")` than in  `r FunFisc(1)`. `r sur.london.top.la` was the highest earning council in London and England with a surplus in `r FunFisc()` of £`r FunDec(sur.london.top.amount, dp.text)` million, `r FunDec(abs(sur.london.top.ch), dp.text)` % `r ifelse(sur.london.top.ch > 0, "higher", "lower")` than in `r FunFisc(1)`.

\newpage

```{r surlondtab}
# print summary data
london.surplus.totals.table.formatted %>% 
  kable("latex", 
         booktabs = T, 
         digits = 0, 
         longtable = T,
         escape = F,
         align = c("r"),
         caption = "Parking surpluses (and deficits) for London (£ millions)",
       # format.args = list(big.mark = ","),
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz, 
                       paste0("Change ", current.year, "-", current.year-1999, 
                              " on ", current.year-1, "-", current.year-1999-1))) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_header"), 
                font_size = 10) %>% 
  column_spec(1, width = "4.5cm") %>% 
  row_spec(c(33, 35), hline_after = TRUE) %>% 
  footnote(symbol = "Where the change in surplus is actually a change in deficit, the values are in italics")
```

```{r surengtab}
# print summary data
eng.rest.surplus.totals.table.formatted %>% 
  kable("latex", 
         booktabs = T, 
         digits = 0, 
         longtable = T,
         escape = F,
         align = c("r"),
         caption = "Parking surpluses (on-street and off-street) for top 20 councils outside London (£ millions)",
         linesep = "",
         col.names = c("\\multirow{1}{*}[0pt]{Local Authority}", yearz, 
                       paste0("Change ", current.year, "-", current.year-1999, 
                              " on ", current.year-1, "-", current.year-1999-1))) %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position", "striped", "repeat_header"), 
                font_size = 10) %>% 
  column_spec(1, width = "4cm") %>% 
  row_spec(c(20), hline_after = TRUE) 
```

The total surplus from parking outside London in `r FunFisc()` was £460.8 million, a 5% increase on `r FunFisc(1)`. With £`r sur.rest.top.amount` million, `r sur.rest.top.la` made the largest surplus outside London, which also ranks as the `r ordinal(sur.rest.top.rank)` largest  nationally.

# Comparison with budgets for `r FunFisc()` and `r FunFisc(-1)`

The total budgeted parking surplus for `r FunFisc()` was £`r FunDec(budg.curr, 0)`  million compared with the actual outturn of £`r FunDec(sur.tot, 0)` million (excluding national parks and \color{red}trading\color{black}). `r FunFirstup(xfun::numbers_to_words(budg.over))` councils exceeded their budgets by a total of £`r FunDec(budg.over.amount,0)` million and `r budg.under`  were below budget by a total of £`r FunDec(abs(budg.under.amount),0)` million.  \color{red} The London boroughs, with their larger incomes, were more likely to have large excess surpluses compared with budget\color{black}.  `r budg.over.la` made a £`r FunDec(budg.over.sur, dp.text)` million `r ifelse(budg.over.sur > 0, "surplus", "deficit")` compared with a budgeted `r ifelse(budg.over.bud > 0, "surplus", "deficit")` of £`r FunDec(abs(budg.over.bud), dp.text)` million. `r budg.under.la`, on the other hand, fell £`r FunDec(abs(budg.under.diff), dp.text)` million short of meeting its budgeted `r ifelse(budg.under.bud > 0, "surplus", "deficit")` of £`r FunDec(abs(budg.under.bud), dp.text)` million. 

For `r FunFisc(-1)`, the total parking surplus is budgeted to be £`r FunDec(budg.next,0)` million compared with the `r FunFisc()` outturn of £`r FunDec(sur.curr, 0)` million (excluding national parks and trading).


# Congestion charge

The central London congestion charge raised £`r FunDec(sur.c.c.curr,0)`  million in `r FunFisc()` net of expenditure compared with £`r FunDec(sur.c.c.last,0)`  million the previous year, with `r ifelse(inc.c.c.ch < 0 & exp.c.c.ch < 0, "both income and expenditure falling", ifelse(inc.c.c.ch < 0 & exp.c.c.ch > 0, "income falling and expenditure rising", ifelse(inc.c.c.ch > 0 & exp.c.c.ch < 0,  "income rising and expenditure falling", "bothe income and expenditure rising")))` \color{red} despite an increase in the charge as from January 2018\color{black}. This was  below the budget of £`r FunDec(budg.c.c.curr,0)` million. For `r FunFisc(-1)` TfL is budgeting £`r FunDec(budg.c.c.next,0)` million. It is a relatively expensive charge to collect with `r FunDec(prop.net.expen, dp.text)` % of the income spent on collection in the current fiscal year. 

\renewcommand{\arraystretch}{1.3}

```{r congchtab, echo = FALSE, message = FALSE, warning = FALSE}
# print summary data
cong.ch.formatted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 2, 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Summary of London congestion charge (£ millions)",
         col.names = c("", yearz, paste0("\\multirow{1}{*}[0pt]{",FunFisc(-1),"}")),
         linesep = "") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("HOLD_position"), 
                font_size = 10)  %>% 
  column_spec(1, width = "4.5cm") %>% 
  row_spec(4, italic = TRUE)  %>% 
  row_spec(2,  extra_latex_after = "\\cline{1-6}") %>% 
    row_spec(c(3,4),  extra_latex_after = "\\cline{1-7}") 
```
\renewcommand{\arraystretch}{1.2}

# Appendix 


```{r alphatab}

england.alpha %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 2, 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Local Authority Parking Operations Revenue Outturn for England -- Current account surplus (Alphabetical) (£ millions)",
         col.names = c("", "Auth. type", yearz, paste0("Ranking by ", FunFisc(), " surplus")),
         linesep = "") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("repeat_header", "striped"),
                stripe_color = "gray!20",
                font_size = 10)  %>% 
  column_spec(1, width = "4.5cm") 


```



```{r  sorted}
england.sorted %>% 
  kable( "latex", 
         booktabs = T, 
         digits = 2, 
         escape = F,
         longtable = T,
         align = c("r"),
         caption = "Local Authority Parking Operations Revenue Outturn for England -- Current account surplus (Ranked by size of surplus) (£ millions)",
         col.names = c("", "Auth. type", yearz),
         linesep = "") %>% 
  kable_styling(full_width = TRUE, 
                latex_options =c("repeat_header", "striped"),
                stripe_color = "gray!20",
                font_size = 10)  %>% 
  column_spec(1, width = "4.5cm") 

```

\newpage

## References {-}